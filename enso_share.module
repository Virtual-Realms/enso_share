<?php


function enso_share_preprocess_link(&$vars) { 

  // Get link attributes
  $attributes = $vars['options']['attributes'];

  // Ensure link has a class attribute
  if (array_key_exists('class', $attributes)) {

    // Get the class array
    $class = $attributes['class'];

    // When links generated by the Service Links module
    if (strpos($class[0], 'service-links') !== false) {

      // Get the Service Links service name
      $service = str_replace('service-links-', '', $class[0]);

      // Map Service Links service name to the Font Awesome icon name
      switch ($service) {
        case 'printmail':
          $fa_icon = 'envelope-o';
          break;
        case 'printpdf':
          $fa_icon = 'file-pdf-o';
          break;
        default:
          $fa_icon = $service;
          break;
      }

      // Create Font Awesome icon and text markup
      $markup = array(
        '#type' => 'markup',
        '#markup' => '<span class="service-links-icon fa fa-' . $fa_icon . '"></span><span class="service-links-text">' . $vars['options']['title'] . '</span>',
      );

      // Modify existing link to include new HTML markup
      $vars['options']['html'] = true;
      $vars['text'] = drupal_render($markup);
    }

    // When links generated by the Follow module
    else if ($class[0] === 'follow-link') {

      // Get the Follow service name
      $service = str_replace('follow-link-', '', $class[1]);

      // Map Follow name to the Font Awesome icon name
      switch ($service) {
        case 'this-site':
          $fa_icon = 'rss';
          break;
        case 'googleplus':
          $fa_icon = 'google-plus';
          break;
        default:
          $fa_icon = $service;
          break;
      }

      // Create Font Awesome icon and text markup
      $markup = array(
        '#type' => 'markup',
        '#markup' => '<span class="follow-link-icon fa fa-' . $fa_icon . '"></span><span class="follow-link-text">' . $vars['text'] . '</span>',
      );

      // Modify existing link to include new HTML markup
      $vars['options']['html'] = true;
      $vars['text'] = drupal_render($markup);
    }
  }
}